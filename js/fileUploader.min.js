"use strict";$.fn.extend({fileUploader:function(e){var e=void 0===e?{}:e;FileUploader.Options.processOptions(e),this.each(function(){FileUploader.load(this)})}});var FileUploader={fileType:"image/*",load:function(e){FileUploader.Makers.appendElements(e),FileUploader.Makers.addClickEvents(e)},Options:{validateOptions:function(e){},processOptions:function(e){FileUploader.Options.validateOptions(e)}},Makers:{appendElements:function(e){var t=$(e).width(),a=$(e).height(),i=$(e).attr("id"),n=$('<canvas id="canvas_'+i+'" width="'+t+'" height="'+a+'"></canvas>');$(e).append(n);var r=null!==FileUploader.fileType?' accept="'+FileUploader.fileType+'" ':"",l=$('<input onchange="FileUploader.Makers.change(this)" id="file_'+i+'" type="file" style="display:none" '+r+"/>");$(e).append(l)},addClickEvents:function(e){var t=$(e).attr("id");$("#canvas_"+t).click(function(){$("#file_"+t).trigger("click")})},change:function(e){var t=$(e).attr("id"),a=FileUploader.Files.getFile(t);FileUploader.Files.getOrientation(a,function(t){var i=new FileReader;i.readAsDataURL(a),i.onload=function(a){FileUploader.Files.changeCanvas(a,e,t)}})}},Files:{getFile:function(e){return void 0!==navigator&&void 0!==navigator.galleryCamera?navigator.galleryCamera.getFile(e):document.getElementById(e).files[0]},changeCanvas:function(e,t,a){var i=$(t).prev().attr("id");$("#"+i).css({transform:""});var n=new Image;n.src=e.target.result,n.onload=function(){var e=document.getElementById(i),t=e.height,r=e.width,l=n.width/n.height;if(n.height>n.width)var o=(s=t)*l;else var s=(o=r)/l;var d=(e.width-o)/2,c=(e.height-s)/2,g=e.getContext("2d");g.clearRect(0,0,e.width,e.height),g.drawImage(n,d,c,o,s),FileUploader.Files.rotate(i,a)}},getOrientation:function(e,t){var a=new FileReader;a.readAsArrayBuffer(e),a.onload=function(e){var a=new DataView(e.target.result);if(65496!=a.getUint16(0,!1))return t(-2);for(var i=a.byteLength,n=2;n<i;){var r=a.getUint16(n,!1);if(n+=2,65505==r){if(1165519206!=a.getUint32(n+=2,!1))return t(-1);var l=18761==a.getUint16(n+=6,!1);n+=a.getUint32(n+4,l);var o=a.getUint16(n,l);n+=2;for(var s=0;s<o;s++)if(274==a.getUint16(n+12*s,l))return t(a.getUint16(n+12*s+8,l))}else{if(65280!=(65280&r))break;n+=a.getUint16(n,!1)}}return t(-1)}},rotate:function(e,t){if(t>0&&t<9){var a="";2==t?$("#"+e).css({transform:"scaleX(-1)"}):5!=t&&7!=t&&4!=t||(a=" scaleX(-1)"),5==t||6==t?$("#"+e).css({transform:"rotate(90deg)"+a}):3==t||4==t?$("#"+e).css({transform:"rotate(180deg)"+a}):7!=t&&8!=t||$("#"+e).css({transform:"rotate(-90deg)"+a})}}}};
