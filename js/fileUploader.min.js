"use strict";$.fn.extend({fileUploader:function(e){var e=void 0===e?{}:e;FileUploader.Options.processOptions(e),this.each(function(){FileUploader.load(this)})}});var FileUploader={allowedOptions:["defaultImage"],fileType:null,defaultImage:null,load:function(e){FileUploader.Makers.appendElements(e),FileUploader.Makers.addClickEvents(e),FileUploader.Makers.setDefaultImage(e)},Options:{validateOptions:function(e){if("object"!=typeof e)throw Error("invalid params");Object.keys(e).forEach(function(e){if(-1===FileUploader.allowedOptions.indexOf(e))throw Error("invalid param: "+e)})},processOptions:function(e){FileUploader.Options.validateOptions(e),FileUploader.fileType="image/*",void 0!==e.defaultImage&&(FileUploader.defaultImage=e.defaultImage)}},Makers:{appendElements:function(e){var a=$(e).width(),t=$(e).height(),i=$(e).attr("id"),r=$('<canvas id="canvas_'+i+'" width="'+a+'" height="'+t+'"></canvas>');$(e).append(r);var n=null!==FileUploader.fileType?' accept="'+FileUploader.fileType+'" ':"",l=$('<input onchange="FileUploader.Makers.change(this)" id="file_'+i+'" type="file" style="display:none" '+n+"/>");$(e).append(l)},addClickEvents:function(e){var a=$(e).attr("id");$("#canvas_"+a).click(function(){$("#file_"+a).trigger("click")})},change:function(e){var a=$(e).attr("id"),t=FileUploader.Files.getFile(a);FileUploader.Image.getOrientation(t,function(a){var i=new FileReader;i.readAsDataURL(t),i.onload=function(t){FileUploader.Image.changeCanvas(t,e,a)}})},setDefaultImage:function(e){if(null!==FileUploader.defaultImage){var a="canvas_"+$(e).attr("id"),t=new Image;t.src=FileUploader.defaultImage,t.onload=function(e){var i=document.getElementById(a);FileUploader.Image.resizeImage(t,i)}}}},Files:{getFile:function(e){return void 0!==navigator&&void 0!==navigator.galleryCamera?navigator.galleryCamera.getFile(e):document.getElementById(e).files[0]}},Image:{resizeImage:function(e,a){var t=a.height,i=a.width,r=e.width/e.height;if(e.height>e.width)var n=(l=t)*r;else var l=(n=i)/r;var o=(a.width-n)/2,d=(a.height-l)/2,s=a.getContext("2d");s.clearRect(0,0,a.width,a.height),s.drawImage(e,o,d,n,l)},changeCanvas:function(e,a,t){var i=$(a).prev().attr("id");$("#"+i).css({transform:""});var r=new Image;r.src=e.target.result,r.onload=function(){var e=document.getElementById(i);FileUploader.Image.resizeImage(r,e),FileUploader.Image.rotate(i,t)}},getOrientation:function(e,a){var t=new FileReader;t.readAsArrayBuffer(e),t.onload=function(e){var t=new DataView(e.target.result);if(65496!=t.getUint16(0,!1))return a(-2);for(var i=t.byteLength,r=2;r<i;){var n=t.getUint16(r,!1);if(r+=2,65505==n){if(1165519206!=t.getUint32(r+=2,!1))return a(-1);var l=18761==t.getUint16(r+=6,!1);r+=t.getUint32(r+4,l);var o=t.getUint16(r,l);r+=2;for(var d=0;d<o;d++)if(274==t.getUint16(r+12*d,l))return a(t.getUint16(r+12*d+8,l))}else{if(65280!=(65280&n))break;r+=t.getUint16(r,!1)}}return a(-1)}},rotate:function(e,a){if(a>0&&a<9){var t="";2==a?$("#"+e).css({transform:"scaleX(-1)"}):5!=a&&7!=a&&4!=a||(t=" scaleX(-1)"),5==a||6==a?$("#"+e).css({transform:"rotate(90deg)"+t}):3==a||4==a?$("#"+e).css({transform:"rotate(180deg)"+t}):7!=a&&8!=a||$("#"+e).css({transform:"rotate(-90deg)"+t})}}}};